### Github Role Module

This folder contains terraform a module which set ups Github'S OID provider to get short-lived credentials needed for you actions. Specifying role-to-assume without providing an aws-access-key-id or web-identity-token file will signal to the action that you wish to use the OIDC provider.

Examples
```
    - name: Configure AWS Credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-region: us-east-2
        role-to-assume: arn:aws:iam::123456789100:role/my-github-actions-role
        role-session-name: MySessionName
```

In this example, the Action will load the OIDC token from the GitHub-provided environment variable and use it to assume the role arn:aws:iam::123456789100:role/my-github-actions-role with the session name MySessionName.

### Open-id-connect module

This module is responsible for creating the da_ayr_github_actions_open_id_connect role in the AWS management account. The role is assigned a set of policies defined in the templates folder, which grants it the necessary permissions to carry out pipeline-related tasks.

Running this module through the pipeline is not possible, as destroying the Terraform infrastructure will also destroy the associated GitHub role. This is why the setup folder is kept separate from the main Terraform infrastructure code. To run this module, you will need to clone the repository and run it manually on your local machine. The necessary terraform.tfvars variables are saved in the AWS Parameter Store under the management account, under the name setup-terraform-tfvars and set-up-backend-config-auto-tfvars which you can retrieve after cloning the repository to your local machine.

How to set up backend-config-auto-tfvars?
1. Retrieve set-up-backend-config-auto-tfvars from the parametor store and save it as backend-config.auto.tfvars in /setup/environments/managment
2. Retrieve setup-terraform-tfvars from the parametor store adn save it as terraform.tfvars in
/setup/environments/managment

How to run this terraform folder locally from your machine?

Firstly, you must generate AWS credentials, you can follow these step:

1. Log in to your AWS account using your AWS Management Console
2. Click on your account name at the top right corner of the console, and then click on "My Security Credentials" in the dropdown menu.
3. In the "Access keys (access key ID and secret access key)" section, click on "Create New Access Key".
4. Click on "Download Key File" to save your access key ID and secret access key to your computer. These credentials are used to authenticate and authorize your access to AWS resources.
5. Once you have downloaded the access key ID and secret access key, you can use them to authenticate API requests to AWS services, or configure AWS CLI, AWS SDK, or other AWS tools to use them.

Once you have completed these steps, you must configure you AWS Credentials in an AWS profile in your machine, you can follow these steps:

1. Open a terminal or command prompt on your machine.
2. Install the AWS CLI (Command Line Interface) tool on your machine, if you have not already done so.
3. Run the command aws configure --profile <profile-name> to create a new AWS profile with the specified name. Replace <profile-name> with a name for your new profile (e.g., "yourname-da-ayr-admin").
4. Enter the AWS access key ID and secret access key that you downloaded earlier when prompted. You will also be prompted to enter your default region and output format preferences.
5. Once you have entered your credentials and preferences, the AWS CLI will create a new profile in the ~/.aws/credentials file on your machine. You can confirm that the profile was created successfully by running the command cat ~/.aws/credentials and looking for the new profile section.

Once these steps are completed make sure you set up AWS MFA (Multi-Factor Authentication) on your phone, if you haven't done so already follow these steps:

1. Install an authenticator app on your smartphone. Some popular options include Google Authenticator
2. Log in to your AWS account and navigate to the IAM (Identity and Access Management) dashboard.
3. Select the user for whom you want to set up MFA and click on the "Security credentials" tab.
4. Under the "Multi-factor authentication (MFA)" section, click on "Manage MFA".
5. Click on "Activate MFA".
6. Select "A virtual MFA device" and click on "Next Step".
7. Open the authenticator app on your phone and scan the QR code that appears on the screen.
8. Enter the code generated by the app in the "MFA code 1" field and click on "Assign MFA".
9. Repeat the previous step to enter the code generated by the app in the "MFA code 2" field.

After completing the previous steps, please follow these instructions to continue:

1. Open the script.py file located in the setup folder and update the two variables named aws_account_name and aws_profile_name on line 4 and 5, respectively.

2. The aws_account_name variable should be updated with your IAM user name. You can find this information by logging in to the AWS Console, clicking on your name in the top right corner, and copying the IAM user ID. Paste this ID into the aws_account_name variable.

3. The aws_profile_name variable should be updated with the name of the profile you generated in a previous step in the ~/.aws/credentials file.

4. Navigate to the directory where the script.py file is located in your terminal and enter the command "python3 script.py".

5. Enter your MFA code, which you can find in the authenticator app on your phone.

6. Enter the command "export AWS_PROFILE=session-tna" in your terminal.

7. Change directories into the environment/management folder and run the command "terraform init -backend-config=backend-config.auto.tfvars -upgrade -reconfigure".

8. If everything was successful, you should see the following message: "Successfully configured the backend 's3'! Terraform will automatically use this backend unless the backend configuration changes."
